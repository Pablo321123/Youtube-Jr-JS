<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reprodutor de Vídeo HLS</title>
    <link rel="stylesheet" href="http://localhost:3003/styles/mediaPlayerStyle">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/dplayer@1.26.0/dist/DPlayer.min.css">
    <link rel="shortcut icon" href="http://localhost:3003/styles/favicon" type="image/x-icon">
</head>

<body>

    <div class="container">
        <div class="main-video">
            <div class="dplayer" id="dplayer">
                <script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
                <video id="mediaPlayer" controls></video>
                <h3 class="title">CR7, O 'Milior'</h3>
            </div>
        </div>

        <div class="video-list">
            <div class="vid active">
                <video src="http://localhost:8080?video=O_sonho_do_hexa.m3u8" controls></video>
                <h3 class=" title">1 O SONHO DO HEXA ESTÁ ACABADO</h3>
            </div>
            <div class="vid">
                <video src="http://localhost:8080?video=O_sonho_do_hexa.m3u8" controls></video>
                <h3 class=" title">2 O SONHO DO HEXA ESTÁ ACABADO</h3>
            </div>
            <div class="vid">
                <video src="http://localhost:8080?video=O_sonho_do_hexa.m3u8" controls></video>
                <h3 class=" title">3 O SONHO DO HEXA ESTÁ ACABADO</h3>
            </div>
        </div>

    </div>

    <script>

        function getParametersUrl(parameter) {
            const queryString = window.location.search; // obtém a string de consulta da URL
            const urlParams = new URLSearchParams(queryString); // Cria um objeto a partir da string de consulta
            const param = urlParams.get(parameter) //Obtem o valor do nosso parametro 

            return param
        }

        function getVideoInfo(videoParam) {
            fetch('http://localhost:3003/videos')
                .then(res => res.json())  // Adicione o "return" aqui
                .then(v => {
                    console.log(v[0]);
                })
                .catch(error => {
                    console.error('Erro ao obter dados:', error);
                });
        }

        function loadMediaPlayer() {

            videoParam = getParametersUrl('video')

            var video = document.getElementById('mediaPlayer');
            var videoSrc = `http://localhost:8080/streams/${videoParam}`;

            if (Hls.isSupported()) {
                var hls = new Hls();
                hls.loadSource(videoSrc);
                hls.attachMedia(video);
            }
        }

        function loadVideoList() {
            let listVideo = document.querySelectorAll('.video-list .vid');
            let mainVideo = document.querySelector('.main-video video');
            let mainTitle = document.querySelector('.main-video .title');

            listVideo.forEach(video => {
                video.onclick = () => {
                    listVideo.forEach(vid => vid.classList.remove('active'));
                    video.classList.add('active');

                    if (video.classList.contains('active')) {
                        let src = video.children[0].getAttribute('src')
                        mainVideo.src = src

                        let text = video.children[1].innerHTML
                        mainTitle.innerHTML = text
                    }
                }
            });
        }



        loadMediaPlayer()
        getVideoInfo(videoParam)
        loadVideoList()

    </script>
</body>

</html>